<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="콜맵_fabicon.ico">
    <title>CMap</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            justify-content: center;
            align-items: center;
            text-align: center;
            width: auto;
        }

        .container {
            width: auto;
            margin: 0 auto;
            text-align: center;
            border: 0px solid;
            border-radius: 15px;
            box-shadow: 1px 2px 5px 7px rgba(181,171,171,0.75);
            -webkit-box-shadow: 1px 2px 5px 7px rgba(181,171,171,0.75);
            -moz-box-shadow: 1px 2px 5px 7px rgba(181,171,171,0.75);
        }

        .input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }

        input, select, button {
            padding: 10px;
            font-size: 16px;
            margin: 10px;
        }

        .voice-btn {
            background-size: cover;
            width: 40px;
            height: 40px;
            border: none;
            cursor: pointer;
            border:0px solid;
            border-radius: 50%;
            background-color: dodgerblue;
        }
        .voiceIMG{
            width: 20px;
            height: 20px;
        }
        .routeIMG{
            width: auto;
            height: 30px;
            align-items: center;
            justify-content: center;
            display: block;
            margin-left: 45%;
        }

        #route-btn{
            width: 15%;
            height: 5%;
            border: 0px solid;
            border-radius: 15px;
            background-color: dodgerblue;
            font-weight: bold;
            font-size: 1rem;
        }

        .grid{
            display: grid;
            grid-template-columns: repeat(3, 3fr);
            grid-gap: 5%;
            margin-top: 20px;
            align-items: center;
            text-align: center;
            justify-content: center;
        }
        .gridIMG{
            width: 50px;
            height: 50px;
            border: 0px solid;
            border-radius: 5px;
            margin-top: 10px;
            display: inline-block;
        }

        .button{
            border: 0px solid;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
            background-color: dodgerblue;
            font-weight: bold;
            font-size: 1rem;
            width: auto;
        }

        @media screen and (max-width : 800px){
            #route-btn{
                width: 35%;
                font-size: 1.1rem;
            }

            .routeIMG{
                margin-left: 30%;
                width: 45px;
                height: 45px;
            }
        }
    </style>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=k30kvdvltu"></script>
</head>
<body>
    <div class="container">
        <img src="base.png" style="margin-top: 10px; border: 0xp solid; border-radius: 15px; margin-bottom: -20px;" alt="">
        <div class="input-group" style="margin-bottom: -30px;">
            <!--label for="start">출발지:</label-->
            <input type="text" id="start" list="cities" placeholder="출발지를 입력하세요">
            <button class="voice-btn" id="start-voice"><img src="rglass.png" class="voiceIMG" alt=""></button>
        </div>
        <div class="input-group">
            <!--label for="end">목적지:</label-->
            <input type="text" id="end" list="cities" placeholder="목적지를 입력하세요">
            <button class="voice-btn" id="end-voice"><img src="rglass.png" class="voiceIMG" alt=""></button>
        </div>
        <button id="route-btn"><img class="routeIMG" src="walk.png" alt="">경로 안내</button>
    </div>

    <datalist id="cities">
        <option value="서울">
        <option value="부산">
        <option value="대구">
        <option value="인천">
        <option value="광주">
        <option value="대전">
        <option value="울산">
        <option value="세종">
        <option value="경기">
        <option value="강원">
        <option value="충북">
        <option value="충남">
        <option value="전북">
        <option value="전남">
        <option value="경북">
        <option value="경남">
        <option value="제주">
        <option value="천안">
    </datalist>


    <div class="grid">
        <div class="button" onclick="window.open('')"><img class="gridIMG" src="robot.jpg" alt=""><h3>새싹이</h3></div>
        <div class="button" onclick="window.open('bus_info.html')"><img class="gridIMG" src="bus_stop.png" alt=""><h3>버스정류장</h3></div>
        <div class="button" onclick="window.open('callmap_option.html')"><img class="gridIMG" src="options_setting.png" alt=""><h3>설정</h3></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const startInput = document.getElementById('start');
            const endInput = document.getElementById('end');
            const cities = ["서울", "부산", "대구", "인천", "광주", "대전", "울산", "세종", "경기", "강원", "충북", "충남", "전북", "전남", "경북", "경남", "제주", "천안"];
            
            const userLatitude = 36.8242; //위도
            const userLongitude = 127.1689; //경도

            function setDefaultCity(latitude, longitude) {
                const distanceToCheonan = calculateDistance(latitude, longitude, userLatitude, userLongitude);
                if (distanceToCheonan < 5) { // 5km 이내라면 천안으로 설정
                    startInput.value = "천안";
                }
            }

            function calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371; // 지구의 반경 (km)
                const dLat = (lat2 - lat1) * (Math.PI / 180);
                const dLon = (lon2 - lon1) * (Math.PI / 180);
                const a = 
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) * 
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                const distance = R * c; // 거리 (km)
                return distance;
            }

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    setDefaultCity(latitude, longitude);
                });
            } else {
                console.log("Geolocation is not supported by this browser.");
                setDefaultCity(userLatitude, userLongitude); // Geolocation이 지원되지 않을 때 기본 값 사용
            }

            function startRecognition(inputElement) {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'ko-KR';

                recognition.onresult = (event) => {
                    const city = event.results[0][0].transcript;
                    if (cities.includes(city)) {
                        inputElement.value = city;
                    } else {
                        alert('인식된 도시가 목록에 없습니다.');
                    }
                };

                recognition.start();
            }

            document.getElementById('start-voice').addEventListener('click', () => startRecognition(startInput));
            document.getElementById('end-voice').addEventListener('click', () => startRecognition(endInput));

            document.getElementById('route-btn').addEventListener('click', () => {
                const start = startInput.value;
                const end = endInput.value;

                window.location.href = `CMaproute.html?start=${start}&end=${end}`;
            });
        });
    </script>
</body>
</html>
